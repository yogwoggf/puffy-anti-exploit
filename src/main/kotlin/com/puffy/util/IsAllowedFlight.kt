package com.puffy.util

import net.minecraft.entity.effect.StatusEffect
import net.minecraft.server.network.ServerPlayerEntity

// https://minecraft.fandom.com/wiki/Levitation
private const val LEVITATION_STATUS_ID = 25
// Likely, once the player's velocity reaches this threshold it's probably from a tnt jump or mod
private const val FLIGHT_SPEED_THRESHOLD = 5

fun ServerPlayerEntity.isAllowedFlight(): Boolean {
    // Water internally is implemented as an alternative movement style which isn't walking or
    // flight, but a little in between. So this returns true for water to be safe

    return (this.abilities.flying || this.abilities.allowFlying) ||
        this.isTouchingWater ||
        this.isSubmergedInWater ||
        this.isSwimming ||
        this.isFallFlying ||
        this.hasStatusEffect(StatusEffect.byRawId(LEVITATION_STATUS_ID)) ||
        this.velocity.length() >= FLIGHT_SPEED_THRESHOLD ||
        this.fallDistance > 0
}
